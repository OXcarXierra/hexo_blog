---
title: Union-Find ìë£Œêµ¬ì¡° (ìƒí˜¸ ë°°íƒ€ì  ì§‘í•© Disjoint Set)
tags: [data structure]
categories: [Algorithm]
permalink: ''
thumbnailImage: https://i.imgur.com/jOe1hdP.png
thumbnailImagePosition: right
date: 2022-08-07 14:40:33
---

**BOJ 20040 ì‚¬ì´í´ ê²Œì„**

<!-- excerpt -->
<!-- toc -->

---

## ìƒí˜¸ ë°°íƒ€ì  ì§‘í•© Disjoint Setê³¼ Union-Find ìë£Œêµ¬ì¡°

ì§‘í•©ì˜ ì›ì†Œë“¤ì„ ì—¬ëŸ¬ ê°œì˜ ë¶€ë¶„ì§‘í•©ìœ¼ë¡œ ë‚˜ëˆ„ë˜, ê·¸ ë¶€ë¶„ì§‘í•©ë“¤ì˜ êµì§‘í•©ì´ ì—†ë„ë¡ ë¶„ë¥˜í•˜ëŠ” ìƒí™©ì„ ê°€ì •í•´ ë³´ì. ì´ëŸ¬í•œ ë¶€ë¶„ì§‘í•©ë“¤ì„ **ìƒí˜¸ ë°°íƒ€ì  ì§‘í•©**(í˜¹ì€ ë¶„ë¦¬ì§‘í•©, Disjoint Set)ì´ë¼ê³  í•˜ëŠ”ë°, ì´ ìƒí™©ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ê³ ì•ˆëœ ìë£Œêµ¬ì¡°ê°€ **Union-Find ìë£Œêµ¬ì¡°**ì´ë‹¤.

Union-Find ìë£Œêµ¬ì¡°ëŠ” ì„¸ ê°€ì§€ ì—°ì‚°ì´ ê°€ëŠ¥í•˜ë‹¤.

- ì´ˆê¸°í™” : nê°œì˜ ì›ì†Œê°€ ê°ê°ì˜ ì§‘í•©ì— ë“¤ì–´ìˆì„ ìˆ˜ ìˆë„ë¡ ì´ˆê¸°í™”
- **Find ì—°ì‚°** : ì£¼ì–´ì§„ ì›ì†Œê°€ ì†í•œ ì§‘í•©ì„ ì°¾ì•„(Find) ë°˜í™˜
- **Union ì—°ì‚°** : ì£¼ì–´ì§„ ë‘ ì›ì†Œê°€ ì†í•œ ì§‘í•©ì„ í•˜ë‚˜ë¡œ í•©ì¹¨(Union)

### ë°°ì—´ë¡œ êµ¬í˜„í•œ Union-Find

ì‰½ê²Œ ìƒê°í•´ë³´ë©´, Union-FindëŠ” `arr[i] = iê°€ ì†í•œ ì§‘í•©ì˜ ë²ˆí˜¸` ì¸ 1ì°¨ì› ë°°ì—´ë¡œ ìƒê°í•  ìˆ˜ ìˆë‹¤. ì´ ê²½ìš° Findì—°ì‚°ì€ ë°°ì—´ì— ì§ì ‘ ì ‘ê·¼í•´ì„œ ì°¾ìœ¼ë©´ ë˜ë‹ˆ`O(1)`ì˜ ë³µì¡ë„ë¥¼ ê°€ì§„ë‹¤. ê·¸ëŸ¬ë‚˜, Unionì—°ì‚°ì€ ì „ì²´ ë°°ì—´ì„ í›‘ìœ¼ë©° aë²ˆ ì§‘í•©ì— ì†í•œ ëª¨ë“  ì›ì†Œë¥¼ bë¡œ ë°”ê¿”ì£¼ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, `O(n)`ì˜ ë³µì¡ë„ë¥¼ ê°€ì§„ë‹¤.

### íŠ¸ë¦¬ë¥¼ ì´ìš©í•´ êµ¬í˜„í•œ Union-Find

Findì— ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ì¡°ê¸ˆ ëŠ˜ë¦¬ë”ë¼ë„, Unionì„ ë¹ ë¥´ê²Œ í•  ìˆ˜ ìˆë„ë¡ ê³ ì•ˆëœ ê²ƒì´ íŠ¸ë¦¬ë¥¼ í™œìš©í•œ ë°©ë²•ì´ë‹¤. **í•˜ë‚˜ì˜ ì§‘í•©ì— ì†í•œ ì›ì†Œë“¤ì„ íŠ¸ë¦¬ë¡œ ì—°ê²°**í•˜ë©´, ê°ê°ì˜ ì§‘í•©ì€ ì„œë¡œ ë‹¤ë¥¸ ë£¨íŠ¸ë¥¼ ê°€ì§„ ë…ë¦½ì ì¸ íŠ¸ë¦¬ë¡œ ìƒê°í•  ìˆ˜ ìˆë‹¤. Findì—°ì‚°ì˜ ê²½ìš°, í•´ë‹¹ ì›ì†Œì˜ **ë¶€ëª¨ ë…¸ë“œë¥¼ ë”°ë¼ê°€ì„œ ë£¨íŠ¸ì— ë„ë‹¬**í•˜ë©´ ì–´ë–¤ ì§‘í•©ì— ì†í•´ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤. ë˜í•œ Unionì—°ì‚°ì€ ë‘ ì›ì†Œê°€ ì†í•œ ì§‘í•©ì„ Findë¡œ ì°¾ì•„ë‚¸ í›„ **í•œ ìª½ íŠ¸ë¦¬ë¥¼ ë‹¤ë¥¸ ìª½ íŠ¸ë¦¬ì˜ ì•„ë˜ë¡œ í•©ì¹˜ë©´** ëœë‹¤.

```python íŠ¸ë¦¬ë¥¼ ì´ìš©í•´ êµ¬í˜„í•œ Union-Find
def find(a):
  if a == parent[a]: # ì›ì†Œê°€ íŠ¸ë¦¬ì˜ ë£¨íŠ¸ì¸ ê²½ìš°
    return a
  else:
    return find(parent[a]) # íŠ¸ë¦¬ë¥¼ ì¬ê·€ì ìœ¼ë¡œ ë”°ë¼ ì˜¬ë¼ê°€ ë£¨íŠ¸ ì›ì†Œë¥¼ ë°˜í™˜

def union(a,b):
  a = find(a)
  b = find(b)
  if a==b:
    return -1 # í•©ì¹˜ë ¤ëŠ” ë‘ ì§‘í•©ì´ ê°™ì€ ê²½ìš°
  parent[a] = b
```

ì´ ê²½ìš° Find, Union ì—°ì‚° ëª¨ë‘ íŠ¸ë¦¬ì˜ ë†’ì´ì— ë¹„ë¡€í•œ ë³µì¡ë„ë¥¼ ê°€ì§„ë‹¤. `O(n)`ì˜ ë³µì¡ë„ë¥¼ ê°€ì¡Œë˜ 1ì°¨ì› ë°°ì—´ë³´ë‹¤ í›¨ì”¬ ë¹¨ë¼ì§„ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

## Union-Findì˜ ìµœì í™”

1ë¶€í„° nê¹Œì§€ nê°œì˜ ì›ì†Œë¡œ ì´ˆê¸°í™”ëœ ìƒí˜¸ ë°°íƒ€ì  ì§‘í•©ì„ Union-Find êµ¬ì¡°ë¡œ êµ¬í˜„ëœ ìƒí™©ì„ ìƒê°í•´ë³´ì. 1,2ë¥¼ í•©ì¹˜ê³ , 2,3ì„ í•©ì¹˜ê³ ... iì™€ i+1ì„ í•©ì¹˜ëŠ” ë°˜ë³µì ì¸ ì—°ì‚°ì„ í•œë‹¤ë©´, íŠ¸ë¦¬ì˜ ê¹Šì´ëŠ” ìµœëŒ€ nê¹Œì§€ ëŠ˜ì–´ë‚œë‹¤. ê·¸ë ¤ë©´ Findì—°ì‚°ì˜ ë³µì¡ë„ë„ `O(n)`, Unionì—°ì‚°ì˜ ë³µì¡ë„ë„ `O(n)`ìœ¼ë¡œ ì˜¤íˆë ¤ íš¨ìœ¨ì´ ë‚˜ë¹ ì§„ë‹¤. ì´ë ‡ê²Œ íŠ¸ë¦¬ê°€ í•œìª½ìœ¼ë¡œ ê¸°ìš¸ì–´ì§€ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  êµ¬ì¡°ë¥¼ ìµœì í™”í•˜ëŠ” ë°©ë²•ì€ Union-by-rank, ê²½ë¡œì••ì¶•ìœ¼ë¡œ ë‘ ê°€ì§€ê°€ ìˆë‹¤.

### Union-by-rank

íŠ¸ë¦¬ë¥¼ í•©ì¹˜ëŠ” ê³¼ì •ì—ì„œ ë†’ì´ê°€ ë‚®ì€ íŠ¸ë¦¬ë¥¼ ë†’ì€ íŠ¸ë¦¬ ë°‘ìœ¼ë¡œ ì§‘ì–´ë„£ëŠ”ë‹¤ë©´, ë‘ íŠ¸ë¦¬ì˜ ë†’ì´ê°€ ê°™ì§€ ì•ŠëŠ” ì´ìƒ íŠ¸ë¦¬ì˜ ë†’ì´ê°€ ì¦ê°€í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ê²ƒì´ Union-by-rank ìµœì í™”ë¡œ, `rank=[]` ë°°ì—´ì— ì›ì†Œê°€ ë£¨íŠ¸ì¸ íŠ¸ë¦¬ì˜ ë†’ì´ë¥¼ ì €ì¥í•˜ê³  unionì—°ì‚°ì„ í•  ë•Œ ë†’ì´ë¥¼ ë¹„êµí•œ í›„ ì‹¤í–‰í•˜ë„ë¡ ìˆ˜ì •í•˜ë©´ ëœë‹¤.
ì´ ê³¼ì •ìœ¼ë¡œ Findì™€ Unionì—°ì‚°ì˜ ë³µì¡ë„ë¥¼ `O(logN)`ê¹Œì§€ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

```py Union-by-rank ìµœì í™”
def union(a,b):
  a, b = find(a), find(b)
  if a==b:
    return -1
  if rank[a] > rank[b]: # í•©ì¹˜ë ¤ëŠ” ë‘ íŠ¸ë¦¬ì˜ ë†’ì´ë¥¼ ë¹„êµ
    a, b = b, a
  parent[a] = b
  if rank[a] == rank[b]: # ë‘ íŠ¸ë¦¬ì˜ ë†’ì´ê°€ ê°™ì€ ê²½ìš°ì—ë§Œ íŠ¸ë¦¬ì˜ ë†’ì´ê°€ 1 ì¦ê°€
    rank[b] += 1
```

### ê²½ë¡œ ì••ì¶• Path compression

ì°¾ê¸° ì—°ì‚°ì˜ ë³µì¡ë„ë¥¼ ì¤„ì´ê¸° ìœ„í•´, ì´ë¯¸ ë£¨íŠ¸ë¥¼ ì•„ëŠ” ì›ì†ŒëŠ” ê·¸ ë£¨íŠ¸ë¥¼ ì €ì¥í•˜ëŠ” ê°„ë‹¨í•œ ë°©ë²•ì´ ìˆë‹¤. 5 -> 3 -> 2 -> 1ì˜ ìˆœì„œë¡œ ë£¨íŠ¸ë¥¼ ì°¾ì•˜ë‹¤ë©´, 5ì˜ ë¶€ëª¨ë…¸ë“œë¥¼ 1ë¡œ ê°±ì‹ í•¨ìœ¼ë¡œì¨ ë‹¤ìŒì—ëŠ” 5 -> 1ë¡œ ë£¨íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

```py path compression
def find(a):
  if a == parent[a]:
    return a
  else:
    parent[a] = find(parent[a]) # ë¶€ëª¨ë…¸ë“œë¥¼ ë£¨íŠ¸ë¡œ ê°±ì‹ 
    return parent[a]
```

ë‘ ìµœì í™” ë°©ë²•ì„ ëª¨ë‘ ì ìš©í•œ Union-Find ìë£Œêµ¬ì¡°ëŠ”, Findì—°ì‚°ì˜ ë³µì¡ë„ê°€ í¬ê²Œ ê°ì†Œí•œë‹¤. íŠ¹íˆ Findë¥¼ ì—¬ëŸ¬ ë²ˆ ìˆ˜í–‰í• ìˆ˜ë¡ ë¹¨ë¼ì§€ê²Œ ë˜ëŠ”ë°, ì´ ê²½ìš° í‰ê· ì ìœ¼ë¡œ `O(ğ›¼(N))`ì˜ ë³µì¡ë„ë¥¼ ê°€ì§„ë‹¤ê³  í•œë‹¤. ğ›¼(N)ì€ ì• ì»¤ë§Œ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ì •ì˜ë˜ëŠ” í•¨ìˆ˜ì¸ë° ì‚°ìˆ ì ì¸ Nê°’ì— ëŒ€í•´ì„œ ê·¸ ê°’ì´ 4 ì´í•˜ì´ê¸° ë•Œë¬¸ì—, ì‚¬ì‹¤ìƒ ìƒìˆ˜ì‹œê°„ ë‚´ì— ì‹¤í–‰ëœë‹¤ê³  í•  ìˆ˜ ìˆë‹¤.

## BOJ 20040 ì‚¬ì´í´ ê²Œì„

Path compressionë§Œ ì‚¬ìš©í•´ë„ ì œí•œ ì‹œê°„ ë‚´ë¡œ í†µê³¼ëŠ” ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. ì…ë ¥ì´ ë§ì•„ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— `sys.stdin.readline`ì„ ì´ìš©í•´ì•¼ í•œë‹¤.

### í’€ì´

```python BOJ 20040 ì‚¬ì´í´ê²Œì„
import sys
sys.setrecursionlimit(10**6)
input = sys.stdin.readline
n,m = map(int, input().split())
parent = [i for i in range(n)]
rank = [0 for i in range(n)]

def find(a):
  if a == parent[a]:
    return a
  else:
    parent[a] = find(parent[a])
    return parent[a]

def union(a,b):
  a, b = find(a), find(b)
  if a==b:
    return -1
  if rank[a] > rank[b]:
    a, b = b, a
  parent[a] = b
  if rank[a] == rank[b]:
    rank[b] += 1

def cycle():
  for x in range(m):
    a,b= map(int, input().split())
    if union(a,b) == -1:
      print(x+1)
      return
  print(0)

cycle()
```

> ì°¸ê³ ë¬¸í—Œ
> í”„ë¡œê·¸ë˜ë° ëŒ€íšŒì—ì„œ ë°°ìš°ëŠ” ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œí•´ê²°ì „ëµ (ì¢…ë§Œë¶), 25ì¥
